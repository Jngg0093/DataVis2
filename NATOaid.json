{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": "container",
  "height": 100,
  "data": {
      "url": "https://raw.githubusercontent.com/Jngg0093/DataVis2/main/Data%20Visualisation%202/Data/financialaid.csv",
      "format": {"type": "csv"}
    },
    "transform": [
      {"fold": ["Financial commitments",
    "Humanitarian commitments",
    "Military commitments",
    "Share in total EU commitments"]},
    {
      "aggregate": [{"op":"sum", "field":"value", "as":"summed"}],
      "groupby": ["Alliance","key"]
    }
    ],
    "layer":[
    {"mark": {"type":"bar"},
    "encoding": {
      "x": {"aggregate": "sum", "field": "summed", "title":"Aid (USD$ billion)", "sort":"descending", "scale":{"domain": [0, 190]}},
      "y": {"field": "Alliance", "type":"nominal","sort":"descending", "title":null, "axis":{"orient":"right"}},
      "color": {"field": "key", "legend":null, 
        "scale":{"domain":["Financial commitments",
        "Humanitarian commitments",
        "Military commitments",
        "Share in total EU commitments"], "range":["#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3"]}},
      "tooltip":[
      {"field":"Alliance", "type": "nominal"},
      {"field":"key", "type":"nominal", "title":"Type of aid: "},
      {"field":"summed", "type":"quantitative", "title":"Financial Support (US$ billion)"}
      ]
      }},
      {"transform": [
        {
          "aggregate": [{"op":"sum", "field": "summed", "as":"total"}],
          "groupby": ["Alliance"]
        },
        {
          "calculate": "'$' + format(datum.total, '.2f') + ' billion'",
          "as": "rawtext"
        }
      ],
        "mark":{
          "type": "text",
          "align": "right",
          "dx": -2,
          "baseline": "middle",
          "fontStyle": "bold"
        },
        "encoding":{
          "text": {"field": "rawtext"},
          "y": {"field": "Alliance", "type":"ordinal"},
          "x": {"field": "total", "type": "quantitative"}
        } 
      }
      ]
  }
