{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width":300,
  "height": 200,
  "config": {"view": {
    "stroke": "transparent"
  }},
  "params":[
    {
    "name": "Grouping",
    "value": "Australia",
    "bind": {
      "input": "select",
      "options": ["Australia", "Austria", "Belgium", "Bulgaria", "Canada", "Croatia", "Cyprus", "Czech Republic", "Denmark", "Estonia", "Finland", "France", "Germany", "Greece", "Hungary", "Iceland", "Ireland", "Italy", "Japan", "Latvia", "Lithuania", "Luxembourg", "Malta", "Netherlands", "New Zealand", "Norway", "Poland", "Portugal", "South Korea", "Romania", "Slovakia", "Slovenia", "Spain", "Sweden", "Switzerland", "Turkey", "United Kingdom", "United States", "Taiwan"],
      "name": "Country: "
    }
  }
  ],
  "data": {
      "url": "https://raw.githubusercontent.com/Jngg0093/DataVis2/main/Data%20Visualisation%202/Data/stacked_bar.csv",
      "format": {"type": "csv"}
    },
    "transform": [{"fold": ["Financial commitments",
    "Humanitarian commitments",
    "Military commitments",
    "Share in total EU commitments"]},
    {"filter": "datum.Country == Grouping"}
  ],
  "layer":[{
    "mark": {"type": "arc", "innerRadius": 50},
    "encoding": {
      "theta": {"field": "value", "type": "quantitative"},
      "color":{"field": "key", "type": "nominal","scale":{"domain":["Financial commitments",
      "Humanitarian commitments",
      "Military commitments",
      "Share in total EU commitments"], "range":["#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3"]},"legend":{"orient": "left"}},
      "tooltip":[
        {"field":"Country", "type":"nominal"},
        {"field":"Alliance", "type": "nominal"},
        {"field":"value", "type":"quantitative", "title":"Financial Support (US$ billion)"}
        ]
        }
  },
  {"transform": [
    {
      "aggregate": [{"op":"sum", "field": "value", "as":"total"}],
      "groupby": ["Country"]
    },
    {
      "calculate": "'Total aid:;$' + format(datum.total, '.2f') + ' billion'",
      "as": "rawtext"
    },
    {
      "calculate": "split(datum.rawtext,';')",
      "as": "text_annotation"
    }
  ],
    "mark":{"type":"text"},
    "encoding":{
      "text": {"field": "text_annotation"}
    } 
  }
  ]
 
      
}